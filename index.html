<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/osql.js"></script>

    <script>

        $(document).ready(function () {
            execSelectA();
        });

        $(document).ready(function () {
            execSelectB();
        });

        async function execSelectA() {
            var sql = 'select party_id,party_name,alphabet_rank,number_rank from party where alphabet_rank="A" order by number_rank asc';
            var objects = await osql.connect(sql);
            console.log(objects);
            var html = '';
            html = html + '<table border="1">';



            for (var i = 0; i < objects.length; i++) {
                // html = html + '<li>';
                var object = objects[i];
                // html = html + '<td>' + object.party_id + '</td>';
                html = html + '<ol>' + object.alphabet_rank + "級" + object.number_rank + "位　" + object.party_name + "隊" + '</ol>';

                var member_sql = 'select * from party inner join member where party.party_name = member.party_name and alphabet_rank = "A" and not position= "オペレーター" and number_rank= "' + object.number_rank + '%"  order by is_captain desc';
                var member_objects = await osql.connect(member_sql);
                console.log(member_objects);

                for (var t = 0; t < member_objects.length; t++) {
                    var member_object = member_objects[t];
                    html = html + '<li>' + '<a href="member/combatant_detail.html?member_name=' + member_object.member_name + '"> ' + member_object.member_name + ' </a>' + '</li>';
                    // html = html + '<li>' + member_object.member_name + '</li>';
                }

                var ope_sql = 'select * from party inner join member where party.party_name = member.party_name and position= "オペレーター" and alphabet_rank = "A" and number_rank= "' + object.number_rank + '%" order by is_captain desc';
                var ope_objects = await osql.connect(ope_sql);
                console.log(ope_objects);

                for (var s = 0; s < ope_objects.length; s++) {
                    var ope_object = ope_objects[s];
                    // html = html + '<li>' + ope_object.member_name + '</li>';
                    html = html + '<li>' + '<a href="member/operator_detail.html?member_name=' + ope_object.member_name + '"> ' + ope_object.member_name + ' </a>' + '</li>';
                }



                html = html + '</li>';
            }
            html = html + '</table>';
            document.getElementById('result').innerHTML = html;
        }


        async function execSelectB() {
            var sql = 'select party_id,party_name,alphabet_rank,number_rank from party where alphabet_rank="B" order by number_rank asc';
            var objects = await osql.connect(sql);
            console.log(objects);
            var html = '';
            html = html + '<table border="1">';

            for (var i = 0; i < objects.length; i++) {
                var object = objects[i];
                html = html + '<ol>' + object.alphabet_rank + "級" + object.number_rank + "位　" + object.party_name + "隊" + '</ol>';

                var member_sql = 'select * from party inner join member where party.party_name = member.party_name and not position= "オペレーター" and alphabet_rank = "B" and number_rank= "' + object.number_rank + '%" order by is_captain desc';
                var member_objects = await osql.connect(member_sql);
                console.log(member_objects);

                for (var t = 0; t < member_objects.length; t++) {
                    var member_object = member_objects[t];
                    html = html + '<li>' + '<a href="member/combatant_detail.html?member_name=' + member_object.member_name + '"> ' + member_object.member_name + ' </a>' + '</li>';
                }

                var ope_sql = 'select * from party inner join member where party.party_name = member.party_name and position= "オペレーター" and alphabet_rank = "B" and number_rank= "' + object.number_rank + '%" order by is_captain desc';
                var ope_objects = await osql.connect(ope_sql);
                console.log(ope_objects);

                for (var s = 0; s < ope_objects.length; s++) {
                    var ope_object = ope_objects[s];
                    // html = html + '<li>' + ope_object.member_name + '</li>';
                    html = html + '<li>' + '<a href="member/operator_detail.html?member_name=' + ope_object.member_name + '"> ' + ope_object.member_name + ' </a>' + '</li>';
                }


                html = html + '</li>';
            }
            html = html + '</table>';
            document.getElementById('result2').innerHTML = html;
        }


    </script>

</head>

<body>
    <h1>隊員一覧</h1>
    <h2>A級所属</h2>
    <p id="result"></p>
    <h2>B級所属</h2>
    <p id="result2"></p>
</body>

</body>

</html>