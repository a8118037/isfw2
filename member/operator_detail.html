<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <!-- cssフレームワークの読み込み -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.7.0/dist/css/uikit.min.css" />
        <script src="https://cdn.jsdelivr.net/npm/uikit@3.7.0/dist/js/uikit.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/uikit@3.7.0/dist/js/uikit-icons.min.js"></script>

    <script type="text/javascript" src="../lib/jquery.min.js"></script>
    <script type="text/javascript" src="../lib/osql.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>

    <script>

        $().ready(function () {
            execSelect();
            // 編集ページヘのリンクを作成
            document.getElementById("editPageLink").href = 'operator_edit.html?member_name=' + osql.getParam('member_name');
        });

        async function execSelect() {
            var html = '';
            var member_name = osql.getParam('member_name');
            var sql = `select * from party inner join member where party.party_name = member.party_name and member_name="${member_name}";`;
            var objects = await osql.connect(sql);
            console.log(objects);
            if (objects.length <= 0) {
                document.getElementById('result').innerHTML = 'not found';
                return;
            }
            var object = objects[0];

            html = html + '<ul>';
            html = html + object.member_name;

            html = html + '<li>' + '所属部隊:' + object.alphabet_rank + '級' + object.number_rank + '位' + object.party_name + '隊' + '</li>';
            html = html + '<li>' + 'ポジション:' + object.position + '</li>';
            html = html + '<li>' + '年齢:' + object.age + '</li>';

            html = html + '</ul>'
            document.getElementById('result').innerHTML = html;
        }

        $().ready(function () {
            drowGraph();
        });

        async function drowGraph() {

            var member_name = osql.getParam('member_name');
            var sql = `select * from operator where member_name="${member_name}";`;
            var objects = await osql.connect(sql);
            console.log(objects);
            if (objects.length <= 0) {
                document.getElementById('result').innerHTML = 'not found';
                return;
            }
            var object = objects[0];

            // オペレーターからもってくるやーつをここに書く
            var ctx = document.getElementById("myRaderChart");
            var myRadarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ["トリオン", "機器操作", "情報分析", "並列処理", "戦術", "指揮"],
                    datasets: [{
                        label: object.member_name,
                        data: [object.trion_status, object.equipment_operation_status, object.analysis_status, object.parallel_thinking_status, object.tactics_status, object.order_status],
                        backgroundColor: 'RGBA(225,95,150, 0.5)',
                        borderColor: 'RGBA(225,95,150, 1)',
                        borderWidth: 1,
                        pointBackgroundColor: 'RGB(46,106,177)'

                    }]
                },
                options: {
                    title: {
                        display: true,
                        text: 'パラメーター'
                    },
                    scale: {
                        ticks: {
                            suggestedMin: 0,
                            suggestedMax: 10,
                            stepSize: 2,
                            callback: function (value, index, values) {
                                return value
                            }
                        }
                    }
                }
            });
        }

    </script>

</head>


<body>
    <nav class="uk-navbar-container" uk-navbar>
        <div class="uk-navbar-left">
            <ul class="uk-navbar-nav">
                <li class="uk-active"><a href="../index.html">ワールドトリガー隊員管理システム</a></li>
            </ul>
        </div>
        <div class="uk-navbar-right">
            <ul class="uk-navbar-nav">
                <li><a href="../index.html">隊員一覧</a></li>
                <li><a href="combatant_new.html">新規戦闘員</a></li>
                <li><a href="operator_new.html">新規オペレータ</a></li>
                <li><a href="../party/party_new.html">新規部隊部隊</a></li>
            </ul>
        </div>
    </nav>

    <h1>オペレーター詳細ページ</h1>

    <h3>基本情報</h3>
    <p id="result"></p>

    <h3>能力レーダーチャート</h3>
    <canvas id="myRaderChart"></canvas>

    <br>
    <br>
    <a id="editPageLink" href="">データを修正する</a>
    <!-- <button onclick="button1Pressed()">データを修正する</button> -->
    <br>

</body>

</html>